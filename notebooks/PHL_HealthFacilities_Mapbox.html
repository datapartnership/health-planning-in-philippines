
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>3. Catchment Areas (with Mapbox)</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://datapartnership.org/notebooks/PHL_HealthFacilities_Mapbox.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="2. Catchment Areas (Maguidanao)" href="PHL_HealthFacilities_Raster_Maguindanao.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Methodology
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="PHL_HealthFacilities_Raster_Baguio.html">
   1. Catchment Areas (Baguio)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PHL_HealthFacilities_Raster_Maguindanao.html">
   2. Catchment Areas (Maguidanao)
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3. Catchment Areas (with Mapbox)
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/datapartnership/docs/master?urlpath=tree/notebooks/PHL_HealthFacilities_Mapbox.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/datapartnership/docs"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/datapartnership/docs/issues/new?title=Issue%20on%20page%20%2Fnotebooks/PHL_HealthFacilities_Mapbox.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/PHL_HealthFacilities_Mapbox.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#administative-boundaries">
   3.1. Administative Boundaries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#health-facilities">
   3.2. Health Facilities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#friction-surface">
   3.3. Friction Surface
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#catchment-area">
   3.4. Catchment Area
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-some-maps">
     3.4.1. Save some maps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-travel-time-to-nearest-health-facility-excluding-stations">
     3.4.2. Calculate travel time to nearest health facility (excluding stations)
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Catchment Areas (with Mapbox)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#administative-boundaries">
   3.1. Administative Boundaries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#health-facilities">
   3.2. Health Facilities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#friction-surface">
   3.3. Friction Surface
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#catchment-area">
   3.4. Catchment Area
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-some-maps">
     3.4.1. Save some maps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-travel-time-to-nearest-health-facility-excluding-stations">
     3.4.2. Calculate travel time to nearest health facility (excluding stations)
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="catchment-areas-with-mapbox">
<h1><span class="section-number">3. </span>Catchment Areas (with Mapbox)<a class="headerlink" href="#catchment-areas-with-mapbox" title="Permalink to this headline">#</a></h1>
<p>The following is a simple proof of concept code to calculate catchment areas using the Mapbox Matrix API. The 3 priority sites will be: Province of Bohol; Baguio City; and Maguidanao (BARMM)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a Jupyter Notebook extension which reloads all of the modules whenever you run the code</span>
<span class="c1"># This is optional but good if you are modifying and testing source code</span>
<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="c1"># import skimage.graph as graph</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/gostrocks/src&#39;</span><span class="p">)</span> <span class="c1"># gostrocks is used for some basic raster operations (clip and standardize)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/GOSTNets_Raster/src&#39;</span><span class="p">)</span> <span class="c1"># gostnets_raster has functions to work with friction surface</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/GOSTnets&#39;</span><span class="p">)</span> <span class="c1"># it also depends on gostnets for some reason</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/INFRA_SAP&#39;</span><span class="p">)</span> <span class="c1"># only used to save some raster results</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/HospitalAccessibility/src&#39;</span><span class="p">)</span> <span class="c1"># only used to save some raster results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">functions</span>
<span class="kn">from</span> <span class="nn">functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">mapbox</span> <span class="k">as</span> <span class="nn">mb</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span><span class="p">,</span> <span class="n">find_dotenv</span>
<span class="n">dotenv_path</span> <span class="o">=</span> <span class="n">find_dotenv</span><span class="p">()</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">dotenv_path</span><span class="p">)</span>
<span class="n">mb_token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAPBOX_TOKEN&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mb</span><span class="o">.</span><span class="n">mapbox_tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mb_token</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import GOSTRocks.rasterMisc as rMisc</span>
<span class="c1"># import GOSTNetsRaster.market_access as ma</span>
<span class="c1"># from infrasap import aggregator</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/wb514197/data/PHL/Data&quot;</span> <span class="c1"># Copy of Gabriel&#39;s Data folder in SharePoint</span>
<span class="n">repo_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
<span class="n">out_folder</span> <span class="o">=</span> <span class="s2">&quot;/home/wb514197/data/PHL/output&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">out_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="administative-boundaries">
<h2><span class="section-number">3.1. </span>Administative Boundaries<a class="headerlink" href="#administative-boundaries" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iso3</span> <span class="o">=</span> <span class="s1">&#39;PHL&#39;</span>
<span class="n">global_admin</span> <span class="o">=</span> <span class="s1">&#39;/home/public/Data/GLOBAL/ADMIN/g2015_0_simplified.shp&#39;</span>
<span class="n">adm0</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">global_admin</span><span class="p">)</span>
<span class="n">adm0</span> <span class="o">=</span> <span class="n">adm0</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adm0</span><span class="o">.</span><span class="n">ISO3166_1_</span><span class="o">==</span><span class="n">iso3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">global_admin2</span> <span class="o">=</span> <span class="s1">&#39;/home/public/Data/GLOBAL/ADMIN/Admin2_Polys.shp&#39;</span>
<span class="n">adm2</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">global_admin2</span><span class="p">)</span>
<span class="n">adm2</span> <span class="o">=</span> <span class="n">adm2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adm2</span><span class="o">.</span><span class="n">ISO3</span><span class="o">==</span><span class="n">iso3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">adm2</span> <span class="o">=</span> <span class="n">adm2</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adm2</span><span class="o">.</span><span class="n">WB_ADM1_NA</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Cordillera Administrative region (CAR)&#39;,
       &#39;National Capital region (NCR)&#39;, &#39;Region I (Ilocos region)&#39;,
       &#39;Region II (Cagayan Valley)&#39;, &#39;Region V (Bicol region)&#39;,
       &#39;Region VI (Western Visayas)&#39;, &#39;Region VII (Central Visayas)&#39;,
       &#39;Region VIII (Eastern Visayas)&#39;, &#39;Region XIII (Caraga)&#39;,
       &#39;Autonomous region in Muslim Mindanao (ARMM)&#39;,
       &#39;Region IX (Zamboanga Peninsula)&#39;, &#39;Region X (Northern Mindanao)&#39;,
       &#39;Region XI (Davao Region)&#39;, &#39;Region XII (Soccsksargen)&#39;,
       &#39;Region III (Central Luzon)&#39;, &#39;Region IV-A (Calabarzon)&#39;,
       &#39;Region IV (Southern Tagalog)&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adm2</span> <span class="o">=</span> <span class="n">adm2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adm2</span><span class="o">.</span><span class="n">WB_ADM1_NA</span><span class="o">==</span><span class="s1">&#39;Region VII (Central Visayas)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aoi</span> <span class="o">=</span> <span class="n">adm2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adm2</span><span class="o">.</span><span class="n">WB_ADM2_NA</span><span class="o">==</span><span class="s1">&#39;Bohol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aoi</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/PHL_HealthFacilities_Mapbox_17_1.png" src="../_images/PHL_HealthFacilities_Mapbox_17_1.png" />
</div>
</div>
</section>
<section id="health-facilities">
<h2><span class="section-number">3.2. </span>Health Facilities<a class="headerlink" href="#health-facilities" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doh</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;doh_healthfacilities_april2020.shp&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doh</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/PHL_HealthFacilities_Mapbox_20_1.png" src="../_images/PHL_HealthFacilities_Mapbox_20_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doh</span> <span class="o">=</span> <span class="n">doh</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">doh</span><span class="o">.</span><span class="n">province</span><span class="o">==</span><span class="s1">&#39;BOHOL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doh</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>facilityco</th>
      <th>healthfaci</th>
      <th>typeofheal</th>
      <th>barangay</th>
      <th>municipali</th>
      <th>province</th>
      <th>region</th>
      <th>status</th>
      <th>address</th>
      <th>style</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14672</th>
      <td>17134.0</td>
      <td>DOH000000000002989</td>
      <td>L.g. Cutamora Community Clinic</td>
      <td>Hospital</td>
      <td>Fatima</td>
      <td>UBAY</td>
      <td>BOHOL</td>
      <td>REGION VII (CENTRAL VISAYAS)</td>
      <td>Functional</td>
      <td>Purok 4</td>
      <td>Hospital</td>
      <td>POINT (124.47544 10.05558)</td>
    </tr>
    <tr>
      <th>15381</th>
      <td>17135.0</td>
      <td>DOH000000000005353</td>
      <td>Don Emilio Del Valle Memorial Hospital</td>
      <td>Hospital</td>
      <td>Bood</td>
      <td>UBAY</td>
      <td>BOHOL</td>
      <td>REGION VII (CENTRAL VISAYAS)</td>
      <td>Functional</td>
      <td>None</td>
      <td>Hospital</td>
      <td>POINT (124.47465 10.04462)</td>
    </tr>
    <tr>
      <th>15601</th>
      <td>19009.0</td>
      <td>DOH000000000001864</td>
      <td>Clarin Community Hospital</td>
      <td>Hospital</td>
      <td>Poblacion</td>
      <td>CLARIN</td>
      <td>BOHOL</td>
      <td>REGION VII (CENTRAL VISAYAS)</td>
      <td>Functional</td>
      <td>Poblacion</td>
      <td>Hospital</td>
      <td>POINT (124.02349 9.96308)</td>
    </tr>
    <tr>
      <th>17029</th>
      <td>17124.0</td>
      <td>DOH000000000006827</td>
      <td>Ubay Rural Health Unit 1</td>
      <td>Rural Health Unit</td>
      <td>Poblacion</td>
      <td>UBAY</td>
      <td>BOHOL</td>
      <td>REGION VII (CENTRAL VISAYAS)</td>
      <td>Functional</td>
      <td>None</td>
      <td>Rural Health Unit</td>
      <td>POINT (124.47443 10.05478)</td>
    </tr>
    <tr>
      <th>17030</th>
      <td>17125.0</td>
      <td>DOH000000000024681</td>
      <td>Camambugan Barangay Health Station</td>
      <td>Barangay Health Station</td>
      <td>Camambugan</td>
      <td>UBAY</td>
      <td>BOHOL</td>
      <td>REGION VII (CENTRAL VISAYAS)</td>
      <td>Functional</td>
      <td>Purok 4</td>
      <td>Barangay Health Station</td>
      <td>POINT (124.43530 10.05757)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Looking at the NHFR Excel tables received, it looks like there are three separate sheets per region (CV, Cebu, and CAR).
Load CV (Central Visaya) and try to match location data from DOH.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;NHFR_CENTRAL VISAYAS.xlsx&quot;</span><span class="p">),</span> <span class="s2">&quot;CV_7&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Health Facility Code&#39;, &#39;Health Facility Code Short&#39;, &#39;Facility Name&#39;,
       &#39;Old Health Facility Names&#39;, &#39;Old Health Facility Name 2&#39;,
       &#39;Old Health Facility Name 3&#39;, &#39;Health Facility Type&#39;,
       &#39;Ownership Major Classification&#39;,
       &#39;Ownership Sub-Classification for Government facilities&#39;,
       &#39;Ownership Sub-Classification for private facilities&#39;,
       &#39;Street Name and #           &#39;, &#39;Building name and #&#39;, &#39;Region Name&#39;,
       &#39;Region PSGC&#39;, &#39;Province Name&#39;, &#39;Province PSGC&#39;,
       &#39;City/Municipality Name&#39;, &#39;City/Municipality PSGC&#39;, &#39;Barangay Name&#39;,
       &#39;Barangay PSGC&#39;, &#39;Zip Code&#39;, &#39;Landline Number&#39;, &#39;Landline Number 2&#39;,
       &#39;Fax Number&#39;, &#39;Email Address&#39;, &#39;Alternate Email Address&#39;,
       &#39;Official Website&#39;, &#39;Facility Head: Last Name&#39;,
       &#39;Facility Head: First Name&#39;, &#39;Facility Head: Middle Name&#39;,
       &#39;Facility Head: Position&#39;, &#39;Hospital Licensing Status&#39;,
       &#39;Service Capability&#39;, &#39;Bed Capacity&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="p">[</span><span class="s2">&quot;Province Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CEBU               1299
BOHOL               822
NEGROS ORIENTAL     552
SIQUIJOR             67
Name: Province Name, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">registry</span><span class="p">[</span><span class="s2">&quot;Province Name&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;BOHOL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="p">[</span><span class="s2">&quot;Health Facility Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Barangay Health Station        687
Rural Health Unit               51
Birthing Home                   51
Hospital                        16
Infirmary                        9
General Clinic Laboratory        5
COVID-19 Testing Laboratory      2
Municipal Health Office          1
Name: Health Facility Type, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">registry</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">doh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(822, 546)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">doh</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Health Facility Code&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;facilityco&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False    458
True     376
Name: geometry, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">doh</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/PHL_HealthFacilities_Mapbox_33_1.png" src="../_images/PHL_HealthFacilities_Mapbox_33_1.png" />
</div>
</div>
<p>Strategies to match location for missing facilities: look for zip codes, barangay (adm4 file), maybe geocode (not very confident on this last option)<br />
For now work with those that have location</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">registry</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Something important to ask is whether we should be working with health stations. There are hundreds more, so it might be more insightful to consider access to hospitals and primary care centers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry_filter</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">registry</span><span class="p">[</span><span class="s2">&quot;Health Facility Type&quot;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;Barangay Health Station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry_filter</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Health Facility Code</th>
      <th>Health Facility Code Short</th>
      <th>Facility Name</th>
      <th>Old Health Facility Names</th>
      <th>Old Health Facility Name 2</th>
      <th>Old Health Facility Name 3</th>
      <th>Health Facility Type</th>
      <th>Ownership Major Classification</th>
      <th>Ownership Sub-Classification for Government facilities</th>
      <th>Ownership Sub-Classification for private facilities</th>
      <th>...</th>
      <th>healthfaci</th>
      <th>typeofheal</th>
      <th>barangay</th>
      <th>municipali</th>
      <th>province</th>
      <th>region</th>
      <th>status</th>
      <th>address</th>
      <th>style</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DOH000000000000015</td>
      <td>15</td>
      <td>CALAPE MAIN HEALTH TB DOTS AND BIRTHING CENTER</td>
      <td>CALAPE RURAL HEALTH UNIT</td>
      <td></td>
      <td></td>
      <td>Rural Health Unit</td>
      <td>Government</td>
      <td>Local Government Unit</td>
      <td></td>
      <td>...</td>
      <td>Calape Main Health Tb Dots And Birthing Center</td>
      <td>Rural Health Unit</td>
      <td>Desamparados (pob.)</td>
      <td>CALAPE</td>
      <td>BOHOL</td>
      <td>REGION VII (CENTRAL VISAYAS)</td>
      <td>Functional</td>
      <td>None</td>
      <td>Rural Health Unit</td>
      <td>POINT (123.87170 9.89084)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>DOH000000000000016</td>
      <td>16</td>
      <td>DAGOHOY RURAL HEALTH UNIT</td>
      <td></td>
      <td></td>
      <td></td>
      <td>Rural Health Unit</td>
      <td>Government</td>
      <td>Local Government Unit</td>
      <td></td>
      <td>...</td>
      <td>Dagohoy Rural Health Unit</td>
      <td>Rural Health Unit</td>
      <td>Poblacion</td>
      <td>DAGOHOY</td>
      <td>BOHOL</td>
      <td>REGION VII (CENTRAL VISAYAS)</td>
      <td>Functional</td>
      <td>None</td>
      <td>Rural Health Unit</td>
      <td>POINT (124.27175 9.89131)</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 46 columns</p>
</div></div></div>
</div>
</section>
<section id="friction-surface">
<h2><span class="section-number">3.3. </span>Friction Surface<a class="headerlink" href="#friction-surface" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wp_1km</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;phl_ppp_2020_1km_Aggregated_UNadj.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inP</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">wp_1km</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clip the pop raster to AOI</span>
<span class="n">out_pop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;pop_bohol.tif&quot;</span><span class="p">)</span>
<span class="c1"># rMisc.clipRaster(inP, aoi, out_pop, bbox=False, buff=0.1)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pop_surf</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_pop</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># standardize so that they have the same number of pixels and dimensions</span>
<span class="n">out_pop_surface_std</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;pop_bohol_STD.tif&quot;</span><span class="p">)</span>
<span class="c1"># rMisc.standardizeInputRasters(pop_surf, travel_surf, out_pop_surface_std, resampling_type=&quot;nearest&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a data frame of all points</span>
<span class="n">pop_surf</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_pop_surface_std</span><span class="p">)</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">pop_surf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">xys</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">pop_surf</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;spatial_index&#39;</span><span class="p">:</span> <span class="n">indices</span><span class="p">,</span> 
    <span class="s1">&#39;xy&#39;</span><span class="p">:</span> <span class="n">xys</span><span class="p">,</span> 
    <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="n">pop</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="p">})</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pointid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># drop non-populated points</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># res_df.loc[:,&#39;xy&#39;] = res_df[&#39;xy&#39;].apply(Point)</span>
<span class="n">res_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">res_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">res_df</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">registry_filter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5194, 71)
</pre></div>
</div>
</div>
</div>
</section>
<section id="catchment-area">
<h2><span class="section-number">3.4. </span>Catchment Area<a class="headerlink" href="#catchment-area" title="Permalink to this headline">#</a></h2>
<p>For every health facility, calculate travel time between origin point and health facility. Then for each point, keep the id of the health facility with the minimum travel time (closest idx) using Mapbox!</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>spatial_index</th>
      <th>xy</th>
      <th>pop</th>
      <th>pointid</th>
      <th>hrs_to_hosp_or_clinic</th>
      <th>mins_to_hosp_or_clinic</th>
      <th>dist_to_hosp_or_clinic</th>
      <th>closest_hosp_or_clinic_id</th>
      <th>closest_hosp_or_clinic_name</th>
      <th>closest_hosp_or_clinic_geom_lon_x</th>
      <th>closest_hosp_or_clinic_geom_lat_y</th>
      <th>closest_hosp_or_clinic_geodetic_dist</th>
      <th>mb_snapped_dest_name</th>
      <th>mb_snapped_dest_dist</th>
      <th>mb_snapped_dest_lon_x</th>
      <th>mb_snapped_dest_lat_y</th>
      <th>mb_snapped_src_name</th>
      <th>mb_snapped_src_dist</th>
      <th>mb_snapped_src_lon_x</th>
      <th>mb_snapped_src_lat_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1583</th>
      <td>(11, 120)</td>
      <td>POINT (124.62083 10.26250)</td>
      <td>233.189651</td>
      <td>1583</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1676</th>
      <td>(12, 80)</td>
      <td>POINT (124.28750 10.25417)</td>
      <td>94.150398</td>
      <td>1676</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1677</th>
      <td>(12, 81)</td>
      <td>POINT (124.29583 10.25417)</td>
      <td>362.527374</td>
      <td>1677</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1682</th>
      <td>(12, 86)</td>
      <td>POINT (124.33750 10.25417)</td>
      <td>24.213766</td>
      <td>1682</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1695</th>
      <td>(12, 99)</td>
      <td>POINT (124.44583 10.25417)</td>
      <td>176.003372</td>
      <td>1695</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
      <td>-1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_gdf</span><span class="o">.</span><span class="n">xy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry_filter</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">registry_filter</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry_filter</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">registry_filter</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;Health Facility Code&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visual= plot_df_single(res_gdf, &#39;xy&#39;, color = &#39;blue&#39;, alpha = 0.8, hover_cols=[&#39;pop&#39;])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">origins_driving</span> <span class="o">=</span> <span class="n">get_travel_times_mapbox</span><span class="p">(</span>
    <span class="n">origins</span> <span class="o">=</span> <span class="n">res_gdf</span><span class="p">,</span>
    <span class="n">destinations</span> <span class="o">=</span> <span class="n">registry_filter</span><span class="p">,</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;driving&#39;</span><span class="p">,</span>
    <span class="n">d_name</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">dest_id_col</span> <span class="o">=</span> <span class="s2">&quot;idx&quot;</span><span class="p">,</span>
    <span class="n">n_keep</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">num_retries</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">starting_token_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">use_pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">do_pickle_result</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">dest_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">([</span><span class="n">dest</span><span class="p">],</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">calculate_travel_time</span><span class="p">(</span><span class="n">travel_surf</span><span class="p">,</span> <span class="n">mcp</span><span class="p">,</span> <span class="n">dest_gdf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># drop non-populated points</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># res_df.loc[:, registry.index] = res_df.loc[:, registry.index].apply(lambda x: x/60) # convert to hours</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>spatial_index</th>
      <th>xy</th>
      <th>pop</th>
      <th>pointid</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>...</th>
      <th>448</th>
      <th>449</th>
      <th>450</th>
      <th>451</th>
      <th>452</th>
      <th>453</th>
      <th>454</th>
      <th>455</th>
      <th>456</th>
      <th>457</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1583</th>
      <td>(11, 120)</td>
      <td>POINT (124.62083333333334 10.262500000000001)</td>
      <td>233.189651</td>
      <td>1583</td>
      <td>174.827661</td>
      <td>112.596690</td>
      <td>132.981467</td>
      <td>126.174397</td>
      <td>125.830508</td>
      <td>89.194147</td>
      <td>...</td>
      <td>83.001395</td>
      <td>80.219273</td>
      <td>125.275623</td>
      <td>124.507856</td>
      <td>58.504034</td>
      <td>127.471059</td>
      <td>114.321564</td>
      <td>97.282982</td>
      <td>100.968181</td>
      <td>182.230204</td>
    </tr>
    <tr>
      <th>1676</th>
      <td>(12, 80)</td>
      <td>POINT (124.28750000000001 10.254166666666668)</td>
      <td>94.150398</td>
      <td>1676</td>
      <td>104.289856</td>
      <td>70.685185</td>
      <td>91.069961</td>
      <td>109.733454</td>
      <td>109.389565</td>
      <td>44.628835</td>
      <td>...</td>
      <td>86.853345</td>
      <td>57.760563</td>
      <td>54.737817</td>
      <td>53.970050</td>
      <td>58.188452</td>
      <td>97.456000</td>
      <td>85.513612</td>
      <td>55.371476</td>
      <td>35.676160</td>
      <td>140.318698</td>
    </tr>
    <tr>
      <th>1677</th>
      <td>(12, 81)</td>
      <td>POINT (124.29583333333333 10.254166666666668)</td>
      <td>362.527374</td>
      <td>1677</td>
      <td>103.594973</td>
      <td>69.990302</td>
      <td>90.375078</td>
      <td>109.038572</td>
      <td>108.694682</td>
      <td>43.933953</td>
      <td>...</td>
      <td>86.158463</td>
      <td>57.065681</td>
      <td>54.042935</td>
      <td>53.275168</td>
      <td>56.653935</td>
      <td>96.761117</td>
      <td>84.818729</td>
      <td>54.676594</td>
      <td>34.981278</td>
      <td>139.623816</td>
    </tr>
    <tr>
      <th>1682</th>
      <td>(12, 86)</td>
      <td>POINT (124.3375 10.254166666666668)</td>
      <td>24.213766</td>
      <td>1682</td>
      <td>113.083750</td>
      <td>73.920799</td>
      <td>94.305575</td>
      <td>112.850695</td>
      <td>112.506806</td>
      <td>47.864450</td>
      <td>...</td>
      <td>87.198279</td>
      <td>58.984406</td>
      <td>63.531712</td>
      <td>62.763945</td>
      <td>40.853934</td>
      <td>100.691614</td>
      <td>88.749226</td>
      <td>58.607090</td>
      <td>36.106657</td>
      <td>143.554312</td>
    </tr>
    <tr>
      <th>1695</th>
      <td>(12, 99)</td>
      <td>POINT (124.44583333333334 10.254166666666668)</td>
      <td>176.003372</td>
      <td>1695</td>
      <td>123.820979</td>
      <td>79.887000</td>
      <td>100.271776</td>
      <td>115.157095</td>
      <td>114.813206</td>
      <td>52.366185</td>
      <td>...</td>
      <td>89.038979</td>
      <td>61.290806</td>
      <td>74.268941</td>
      <td>73.501174</td>
      <td>2.474874</td>
      <td>106.657815</td>
      <td>94.715427</td>
      <td>64.573291</td>
      <td>45.570285</td>
      <td>149.520514</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 462 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;closest_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="n">registry</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># id of health facility that yields the minimum travel time</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;closest_idx_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="n">registry_filter</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># same but without health stations</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Point</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">res_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#libraries for plotting maps</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">plotting_extent</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>
<span class="kn">import</span> <span class="nn">random</span>
</pre></div>
</div>
</div>
</div>
<section id="save-some-maps">
<h3><span class="section-number">3.4.1. </span>Save some maps<a class="headerlink" href="#save-some-maps" title="Permalink to this headline">#</a></h3>
<p>Issue here is that the colors are being repeated and grouped</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graphs_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Closest health facility for each grid point&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">res_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;closest_idx&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">Terrain</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">,</span> <span class="s2">&quot;Bohol_Catchment_AllHealth.png&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Closest health facility for each grid point&#39;}&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># spec = plt.cm.get_cmap(&#39;tab20c&#39;)</span>
<span class="n">number_of_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_gdf</span><span class="o">.</span><span class="n">closest_idx_filter</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s1">&#39;0123456789ABCDEF&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_colors</span><span class="p">)]</span>

<span class="n">custom</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Closest health facility for each grid point, excluding health stations&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">res_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;closest_idx_filter&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">custom</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">Terrain</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">registry_filter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">,</span> <span class="s2">&quot;Bohol_Catchment_NoStations.png&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Closest health facility for each grid point, excluding health stations&#39;}&gt;
</pre></div>
</div>
<img alt="../_images/PHL_HealthFacilities_Mapbox_72_1.png" src="../_images/PHL_HealthFacilities_Mapbox_72_1.png" />
</div>
</div>
</section>
<section id="calculate-travel-time-to-nearest-health-facility-excluding-stations">
<h3><span class="section-number">3.4.2. </span>Calculate travel time to nearest health facility (excluding stations)<a class="headerlink" href="#calculate-travel-time-to-nearest-health-facility-excluding-stations" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pop_surf</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_pop_surface_std</span><span class="p">)</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">pop_surf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">xys</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">pop_surf</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;spatial_index&#39;</span><span class="p">:</span> <span class="n">indices</span><span class="p">,</span> 
    <span class="s1">&#39;xy&#39;</span><span class="p">:</span> <span class="n">xys</span><span class="p">,</span> 
    <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="n">pop</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="p">})</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pointid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># same analysis but we feed all destinations at once, this returns the travel time to closest</span>
<span class="n">res_min</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">calculate_travel_time</span><span class="p">(</span><span class="n">travel_surf</span><span class="p">,</span> <span class="n">mcp</span><span class="p">,</span> <span class="n">registry_filter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;tt_health&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_min</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>spatial_index</th>
      <th>xy</th>
      <th>pop</th>
      <th>pointid</th>
      <th>tt_health</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1583</th>
      <td>(11, 120)</td>
      <td>POINT (124.6208333333333 10.2625)</td>
      <td>233.189651</td>
      <td>1583</td>
      <td>54.864499</td>
    </tr>
    <tr>
      <th>1676</th>
      <td>(12, 80)</td>
      <td>POINT (124.2875 10.25416666666667)</td>
      <td>94.150398</td>
      <td>1676</td>
      <td>35.676160</td>
    </tr>
    <tr>
      <th>1677</th>
      <td>(12, 81)</td>
      <td>POINT (124.2958333333333 10.25416666666667)</td>
      <td>362.527374</td>
      <td>1677</td>
      <td>34.981278</td>
    </tr>
    <tr>
      <th>1682</th>
      <td>(12, 86)</td>
      <td>POINT (124.3375 10.25416666666667)</td>
      <td>24.213766</td>
      <td>1682</td>
      <td>36.106657</td>
    </tr>
    <tr>
      <th>1695</th>
      <td>(12, 99)</td>
      <td>POINT (124.4458333333333 10.25416666666667)</td>
      <td>176.003372</td>
      <td>1695</td>
      <td>39.898555</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">tt_health</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    5194.000000
mean       11.641249
std        11.376083
min         0.000000
25%         4.767767
50%         8.293451
75%        13.958109
max       120.100080
Name: tt_health, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>These values seem really low! (minutes)<br />
Maybe becuase it’s an island? We need to do some checks…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Point</span><span class="p">)</span>
<span class="n">res_gdf_tt</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">res_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Travel time to nearest health facility, excluding health stations (minutes)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">res_gdf_tt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;tt_health&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma_r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">Terrain</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">registry_filter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">,</span> <span class="s2">&quot;Bohol_TravelTime_NoStations.png&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/PHL_HealthFacilities_Mapbox_82_0.png" src="../_images/PHL_HealthFacilities_Mapbox_82_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># res_min[res_min&gt;99999999] = np.nan</span>
<span class="c1"># res_min = res_min/60</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from mpl_toolkits.axes_grid1 import make_axes_locatable</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># figsize = (12,12)</span>
<span class="c1"># fig, ax = plt.subplots(1, 1,  figsize = figsize)</span>
<span class="c1"># ax.set_title(&quot;Travel time to nearest health facility&quot;, fontsize=14)</span>

<span class="c1"># plt.axis(&#39;off&#39;)</span>
<span class="c1"># ext = plotting_extent(pop_surf)</span>

<span class="c1"># im = ax.imshow(res_min, vmin=0, vmax=1, cmap=&#39;magma_r&#39;, extent=ext)</span>
<span class="c1"># # im = ax.imshow(res_min, norm=colors.PowerNorm(gamma=0.05), cmap=&#39;YlOrRd&#39;, extent=ext)</span>
<span class="c1"># # im = ax.imshow(res_min, cmap=newcmp, extent=ext)</span>

<span class="c1"># # ctx.add_basemap(ax, source=ctx.providers.Esri.WorldShadedRelief, crs=&#39;EPSG:4326&#39;, zorder=-10)</span>
<span class="c1"># ctx.add_basemap(ax, source=ctx.providers.Stamen.Terrain, crs=&#39;EPSG:4326&#39;, zorder=-10)</span>

<span class="c1"># registry_filter.plot(ax=ax, facecolor=&#39;black&#39;, edgecolor=&#39;white&#39;, markersize=50, alpha=1)</span>
<span class="c1"># aoi.plot(ax=ax, facecolor=&#39;none&#39;, edgecolor=&#39;black&#39;)</span>

<span class="c1"># divider = make_axes_locatable(ax)</span>
<span class="c1"># cax = divider.append_axes(&#39;right&#39;, size=&quot;4%&quot;, pad=0.1)</span>
<span class="c1"># cb = fig.colorbar(im, cax=cax, orientation=&#39;vertical&#39;)</span>

<span class="c1"># plt.savefig(os.path.join(graphs_dir, &quot;Bohol_TravelTime_NoStations.png&quot;), dpi=300, bbox_inches=&#39;tight&#39;, facecolor=&#39;white&#39;)</span>
<span class="c1"># # fig = ax.get_figure()</span>
<span class="c1"># # fig.savefig(</span>
<span class="c1"># #     os.path.join(out_folder, &quot;MNG_AirportTravelTime.png&quot;),</span>
<span class="c1"># #     facecolor=&#39;white&#39;, edgecolor=&#39;none&#39;</span>
<span class="c1"># # )</span>
</pre></div>
</div>
</div>
</div>
<p>Save some output data to check values</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;registry.shp&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raster_path</span> <span class="o">=</span> <span class="n">out_pop_surface_std</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;xy&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;closest_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;closest_idx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aggregator</span><span class="o">.</span><span class="n">rasterize_gdf</span><span class="p">(</span><span class="n">res_gdf</span><span class="p">,</span> <span class="s1">&#39;closest_idx&#39;</span><span class="p">,</span> <span class="n">raster_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;closest_idx_.tif&quot;</span><span class="p">),</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="PHL_HealthFacilities_Raster_Maguindanao.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">2. </span>Catchment Areas (Maguidanao)</p>
        </div>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Development Data Partnership<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>