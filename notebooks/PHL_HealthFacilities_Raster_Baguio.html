
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1. Catchment Areas (Baguio)</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://datapartnership.org/notebooks/PHL_HealthFacilities_Raster_Baguio.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Catchment Areas (Maguidanao)" href="PHL_HealthFacilities_Raster_Maguindanao.html" />
    <link rel="prev" title="Health Planning in the Philippines" href="../README.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Methodology
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   1. Catchment Areas (Baguio)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PHL_HealthFacilities_Raster_Maguindanao.html">
   2. Catchment Areas (Maguidanao)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PHL_HealthFacilities_Mapbox.html">
   3. Catchment Areas (with Mapbox)
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/datapartnership/docs/master?urlpath=tree/notebooks/PHL_HealthFacilities_Raster_Baguio.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/datapartnership/docs"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/datapartnership/docs/issues/new?title=Issue%20on%20page%20%2Fnotebooks/PHL_HealthFacilities_Raster_Baguio.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/PHL_HealthFacilities_Raster_Baguio.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#administative-boundaries">
   1.1. Administative Boundaries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#health-facilities">
   1.2. Health Facilities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#friction-surface">
   1.3. Friction Surface
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#catchment-area">
   1.4. Catchment Area
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-some-maps">
     1.4.1. Save some maps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-travel-time-to-nearest-health-facility-excluding-stations">
     1.4.2. Calculate travel time to nearest health facility (excluding stations)
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Catchment Areas (Baguio)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#administative-boundaries">
   1.1. Administative Boundaries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#health-facilities">
   1.2. Health Facilities
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#friction-surface">
   1.3. Friction Surface
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#catchment-area">
   1.4. Catchment Area
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-some-maps">
     1.4.1. Save some maps
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculate-travel-time-to-nearest-health-facility-excluding-stations">
     1.4.2. Calculate travel time to nearest health facility (excluding stations)
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="catchment-areas-baguio">
<h1><span class="section-number">1. </span>Catchment Areas (Baguio)<a class="headerlink" href="#catchment-areas-baguio" title="Permalink to this headline">#</a></h1>
<p>The following is a simple proof of concept code to calculate catchment areas using the Friction Surface. The 3 priority sites will be: Province of Bohol; Baguio City; and Maguidanao (BARMM)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">rasterio</span> <span class="k">as</span> <span class="nn">rio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>
<span class="kn">import</span> <span class="nn">skimage.graph</span> <span class="k">as</span> <span class="nn">graph</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/gostrocks/src&#39;</span><span class="p">)</span> <span class="c1"># gostrocks is used for some basic raster operations (clip and standardize)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/GOSTNets_Raster/src&#39;</span><span class="p">)</span> <span class="c1"># gostnets_raster has functions to work with friction surface</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/GOSTnets&#39;</span><span class="p">)</span> <span class="c1"># it also depends on gostnets for some reason</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/home/wb514197/Repos/INFRA_SAP&#39;</span><span class="p">)</span> <span class="c1"># only used to save some raster results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">GOSTRocks.rasterMisc</span> <span class="k">as</span> <span class="nn">rMisc</span>
<span class="kn">import</span> <span class="nn">GOSTNetsRaster.market_access</span> <span class="k">as</span> <span class="nn">ma</span>
<span class="kn">from</span> <span class="nn">infrasap</span> <span class="kn">import</span> <span class="n">aggregator</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>no xarray
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_dir</span> <span class="o">=</span> <span class="s2">&quot;/home/wb514197/data/PHL/Data&quot;</span> <span class="c1"># Copy of Gabriel&#39;s Data folder in SharePoint</span>
<span class="n">repo_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span>
<span class="n">out_folder</span> <span class="o">=</span> <span class="s2">&quot;/home/wb514197/data/PHL/output&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">out_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="administative-boundaries">
<h2><span class="section-number">1.1. </span>Administative Boundaries<a class="headerlink" href="#administative-boundaries" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iso3</span> <span class="o">=</span> <span class="s1">&#39;PHL&#39;</span>
<span class="n">global_admin</span> <span class="o">=</span> <span class="s1">&#39;/home/public/Data/GLOBAL/ADMIN/g2015_0_simplified.shp&#39;</span>
<span class="n">adm0</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">global_admin</span><span class="p">)</span>
<span class="n">adm0</span> <span class="o">=</span> <span class="n">adm0</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adm0</span><span class="o">.</span><span class="n">ISO3166_1_</span><span class="o">==</span><span class="n">iso3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">global_admin2</span> <span class="o">=</span> <span class="s1">&#39;/home/public/Data/GLOBAL/ADMIN/Admin2_Polys.shp&#39;</span>
<span class="n">adm2</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">global_admin2</span><span class="p">)</span>
<span class="n">adm2</span> <span class="o">=</span> <span class="n">adm2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adm2</span><span class="o">.</span><span class="n">ISO3</span><span class="o">==</span><span class="n">iso3</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">adm2</span> <span class="o">=</span> <span class="n">adm2</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adm2</span><span class="o">.</span><span class="n">WB_ADM1_NA</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Cordillera Administrative region (CAR)&#39;,
       &#39;National Capital region (NCR)&#39;, &#39;Region I (Ilocos region)&#39;,
       &#39;Region II (Cagayan Valley)&#39;, &#39;Region V (Bicol region)&#39;,
       &#39;Region VI (Western Visayas)&#39;, &#39;Region VII (Central Visayas)&#39;,
       &#39;Region VIII (Eastern Visayas)&#39;, &#39;Region XIII (Caraga)&#39;,
       &#39;Autonomous region in Muslim Mindanao (ARMM)&#39;,
       &#39;Region IX (Zamboanga Peninsula)&#39;, &#39;Region X (Northern Mindanao)&#39;,
       &#39;Region XI (Davao Region)&#39;, &#39;Region XII (Soccsksargen)&#39;,
       &#39;Region III (Central Luzon)&#39;, &#39;Region IV-A (Calabarzon)&#39;,
       &#39;Region IV (Southern Tagalog)&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adm2 = adm2.loc[adm2.WB_ADM1_NA==&#39;Region VII (Central Visayas)&#39;].copy()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">admin_name</span> <span class="o">=</span> <span class="s2">&quot;Baguio&quot;</span> <span class="c1">#Bohol Benguet Maguindanao</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adm3</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;hdx&quot;</span><span class="p">,</span> <span class="s2">&quot;phl_admbnda_adm3_psa_namria_20200529.shp&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aoi</span> <span class="o">=</span> <span class="n">adm3</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">adm3</span><span class="o">.</span><span class="n">ADM3_EN</span><span class="o">==</span><span class="s1">&#39;Baguio City&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># aoi = adm2.loc[adm2.WB_ADM2_NA==admin_name].copy()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aoi</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/PHL_HealthFacilities_Raster_Baguio_14_1.png" src="../_images/PHL_HealthFacilities_Raster_Baguio_14_1.png" />
</div>
</div>
</section>
<section id="health-facilities">
<h2><span class="section-number">1.2. </span>Health Facilities<a class="headerlink" href="#health-facilities" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doh</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;doh_healthfacilities_april2020.shp&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doh</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/PHL_HealthFacilities_Raster_Baguio_17_1.png" src="../_images/PHL_HealthFacilities_Raster_Baguio_17_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># doh = doh.loc[doh.province==&#39;Maguindanao&#39;].copy() #BOHOL Maguindanao</span>
<span class="n">doh</span> <span class="o">=</span> <span class="n">doh</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">doh</span><span class="o">.</span><span class="n">municipali</span><span class="o">==</span><span class="s1">&#39;BAGUIO CITY (CAPITAL)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">doh</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>facilityco</th>
      <th>healthfaci</th>
      <th>typeofheal</th>
      <th>barangay</th>
      <th>municipali</th>
      <th>province</th>
      <th>region</th>
      <th>status</th>
      <th>address</th>
      <th>style</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8816</th>
      <td>8912.0</td>
      <td>DOH000000000003493</td>
      <td>Fort Del Pilar Hospital</td>
      <td>Hospital</td>
      <td>Fort Del Pilar</td>
      <td>BAGUIO CITY (CAPITAL)</td>
      <td>BENGUET</td>
      <td>CAR (CORDILLERA ADMINISTRATIVE REGION</td>
      <td>Functional</td>
      <td>Kias Road</td>
      <td>Hospital</td>
      <td>POINT (120.61978 16.36512)</td>
    </tr>
    <tr>
      <th>8817</th>
      <td>8913.0</td>
      <td>DOH000000000005693</td>
      <td>Loakan Barangay Health Station</td>
      <td>Barangay Health Station</td>
      <td>Loakan Proper</td>
      <td>BAGUIO CITY (CAPITAL)</td>
      <td>BENGUET</td>
      <td>CAR (CORDILLERA ADMINISTRATIVE REGION</td>
      <td>Functional</td>
      <td>Loakan Proper</td>
      <td>Barangay Health Station</td>
      <td>POINT (120.61388 16.37662)</td>
    </tr>
    <tr>
      <th>8818</th>
      <td>8914.0</td>
      <td>DOH000000000005693</td>
      <td>Loakan  Barangay Health Station ((New))</td>
      <td>Barangay Health Station</td>
      <td>Loakan Proper</td>
      <td>BAGUIO CITY (CAPITAL)</td>
      <td>BENGUET</td>
      <td>CAR (CORDILLERA ADMINISTRATIVE REGION</td>
      <td>Functional</td>
      <td>Loakan Proper</td>
      <td>Barangay Health Station</td>
      <td>POINT (120.61388 16.37662)</td>
    </tr>
    <tr>
      <th>8819</th>
      <td>8915.0</td>
      <td>DOH000000000002759</td>
      <td>Atok Trail Health Center</td>
      <td>Rural Health Unit</td>
      <td>Atok Trail</td>
      <td>BAGUIO CITY (CAPITAL)</td>
      <td>BENGUET</td>
      <td>CAR (CORDILLERA ADMINISTRATIVE REGION</td>
      <td>Functional</td>
      <td>Atok Trail Proper</td>
      <td>Rural Health Unit</td>
      <td>POINT (120.62648 16.37672)</td>
    </tr>
    <tr>
      <th>8821</th>
      <td>8917.0</td>
      <td>DOH000000000003054</td>
      <td>Scout Barrio Barangay Health Station</td>
      <td>Barangay Health Station</td>
      <td>Scout Barrio</td>
      <td>BAGUIO CITY (CAPITAL)</td>
      <td>BENGUET</td>
      <td>CAR (CORDILLERA ADMINISTRATIVE REGION</td>
      <td>Functional</td>
      <td>Scout Barrio Proper</td>
      <td>Barangay Health Station</td>
      <td>POINT (120.60838 16.39742)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Looking at the NHFR Excel tables received, it looks like there are three separate sheets per region (CV, Cebu, and CAR).
Load CV (Central Visaya) and try to match location data from DOH.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;NHFR_CAR.xlsx&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Health Facility Code&#39;, &#39;Health Facility Code Short&#39;, &#39;Facility Name&#39;,
       &#39;Old Health Facility Names&#39;, &#39;Old Health Facility Name 2&#39;,
       &#39;Old Health Facility Name 3&#39;, &#39;Health Facility Type&#39;,
       &#39;Ownership Major Classification&#39;,
       &#39;Ownership Sub-Classification for Government facilities&#39;,
       &#39;Ownership Sub-Classification for private facilities&#39;,
       &#39;Street Name and #           &#39;, &#39;Building name and #&#39;, &#39;Region Name&#39;,
       &#39;Region PSGC&#39;, &#39;Province Name&#39;, &#39;Province PSGC&#39;,
       &#39;City/Municipality Name&#39;, &#39;City/Municipality PSGC&#39;, &#39;Barangay Name&#39;,
       &#39;Barangay PSGC&#39;, &#39;Zip Code&#39;, &#39;Landline Number&#39;, &#39;Landline Number 2&#39;,
       &#39;Fax Number&#39;, &#39;Email Address&#39;, &#39;Alternate Email Address&#39;,
       &#39;Official Website&#39;, &#39;Facility Head: Last Name&#39;,
       &#39;Facility Head: First Name&#39;, &#39;Facility Head: Middle Name&#39;,
       &#39;Facility Head: Position&#39;, &#39;Hospital Licensing Status&#39;,
       &#39;Service Capability&#39;, &#39;Bed Capacity&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="p">[</span><span class="s2">&quot;Province Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BENGUET              226
IFUGAO               215
ABRA                 203
KALINGA              162
APAYAO               153
MOUNTAIN PROVINCE    150
Name: Province Name, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">registry</span><span class="p">[</span><span class="s2">&quot;Province Name&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;BENGUET&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="p">[</span><span class="s2">&quot;Health Facility Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Barangay Health Station                            167
Rural Health Unit                                   30
Hospital                                            14
Infirmary                                            7
Birthing Home                                        3
COVID-19 Testing Laboratory                          3
Animal Bite Treatment Center                         1
Drug Abuse Treatment and Rehabilitation Centers      1
Name: Health Facility Type, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">registry</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">doh</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(226, 23)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">doh</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;Health Facility Code&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;facilityco&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True     205
False     22
Name: geometry, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">registry</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">doh</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/PHL_HealthFacilities_Raster_Baguio_30_1.png" src="../_images/PHL_HealthFacilities_Raster_Baguio_30_1.png" />
</div>
</div>
<p>Strategies to match location for missing facilities: look for zip codes, barangay (adm4 file), maybe geocode (not very confident on this last option)<br />
For now work with those that have location</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">registry</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># registry = doh.copy()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># registry = registry.loc[registry.intersects(aoi.unary_union)].copy()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># registry[&quot;Health Facility Type&quot;].unique()</span>
<span class="n">registry</span><span class="o">.</span><span class="n">typeofheal</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Hospital&#39;, &#39;Rural Health Unit&#39;, &#39;Barangay Health Station&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Something important to ask is whether we should be working with health stations. There are hundreds more, so it might be more insightful to consider access to hospitals and primary care centers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># registry_filter = registry.loc[registry[&quot;Health Facility Type&quot;]!=&quot;Barangay Health Station&quot;].copy()</span>
<span class="n">registry_filter</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">registry</span><span class="p">[</span><span class="s2">&quot;typeofheal&quot;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;Barangay Health Station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="friction-surface">
<h2><span class="section-number">1.3. </span>Friction Surface<a class="headerlink" href="#friction-surface" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">global_friction_surface</span> <span class="o">=</span> <span class="s2">&quot;/home/public/Data/GLOBAL/INFRA/FRICTION_2020/2020_motorized_friction_surface.geotiff&quot;</span>
<span class="n">wp_1km</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;phl_ppp_2020_1km_Aggregated_UNadj.tif&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inG</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">global_friction_surface</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clip the travel raster to AOI</span>
<span class="n">out_travel_surface</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;travel_surface_</span><span class="si">{</span><span class="n">admin_name</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
<span class="n">rMisc</span><span class="o">.</span><span class="n">clipRaster</span><span class="p">(</span><span class="n">inG</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">out_travel_surface</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">buff</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/wb514197/Repos/gostrocks/src/GOSTRocks/rasterMisc.py:110: UserWarning: Geometry is in a geographic CRS. Results from &#39;buffer&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  inD = inD.buffer(buff)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">inP</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">wp_1km</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clip the pop raster to AOI</span>
<span class="n">out_pop</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;pop_</span><span class="si">{</span><span class="n">admin_name</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">)</span>
<span class="n">rMisc</span><span class="o">.</span><span class="n">clipRaster</span><span class="p">(</span><span class="n">inP</span><span class="p">,</span> <span class="n">aoi</span><span class="p">,</span> <span class="n">out_pop</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">buff</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/wb514197/Repos/gostrocks/src/GOSTRocks/rasterMisc.py:110: UserWarning: Geometry is in a geographic CRS. Results from &#39;buffer&#39; are likely incorrect. Use &#39;GeoSeries.to_crs()&#39; to re-project geometries to a projected CRS before this operation.

  inD = inD.buffer(buff)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">travel_surf</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_travel_surface</span><span class="p">)</span>
<span class="n">pop_surf</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_pop</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># standardize so that they have the same number of pixels and dimensions</span>
<span class="n">out_pop_surface_std</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;pop_</span><span class="si">{</span><span class="n">admin_name</span><span class="si">}</span><span class="s2">_STD.tif&quot;</span><span class="p">)</span>
<span class="n">rMisc</span><span class="o">.</span><span class="n">standardizeInputRasters</span><span class="p">(</span><span class="n">pop_surf</span><span class="p">,</span> <span class="n">travel_surf</span><span class="p">,</span> <span class="n">out_pop_surface_std</span><span class="p">,</span> <span class="n">resampling_type</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([[[-99999., -99999., -99999., ..., -99999., -99999., -99999.],
         [-99999., -99999., -99999., ..., -99999., -99999., -99999.],
         [-99999., -99999., -99999., ..., -99999., -99999., -99999.],
         ...,
         [-99999., -99999., -99999., ..., -99999., -99999., -99999.],
         [-99999., -99999., -99999., ..., -99999., -99999., -99999.],
         [-99999., -99999., -99999., ..., -99999., -99999., -99999.]]],
       dtype=float32),
 {&#39;driver&#39;: &#39;GTiff&#39;,
  &#39;dtype&#39;: &#39;float32&#39;,
  &#39;nodata&#39;: -99999.0,
  &#39;width&#39;: 36,
  &#39;height&#39;: 35,
  &#39;count&#39;: 1,
  &#39;crs&#39;: CRS.from_epsg(4326),
  &#39;transform&#39;: Affine(0.008333333333333333, 0.0, 120.44166666666666,
         0.0, -0.008333333333333333, 16.54166666666667)}]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a data frame of all points</span>
<span class="n">pop_surf</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_pop_surface_std</span><span class="p">)</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">pop_surf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">xys</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">pop_surf</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;spatial_index&#39;</span><span class="p">:</span> <span class="n">indices</span><span class="p">,</span> 
    <span class="s1">&#39;xy&#39;</span><span class="p">:</span> <span class="n">xys</span><span class="p">,</span> 
    <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="n">pop</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="p">})</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pointid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/wb514197/.conda/envs/graph/lib/python3.7/site-packages/pandas/core/dtypes/cast.py:121: ShapelyDeprecationWarning: The array interface is deprecated and will no longer work in Shapely 2.0. Convert the &#39;.coords&#39; to a numpy array instead.
  arr = construct_1d_object_array_from_listlike(values)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create MCP object</span>
<span class="n">inG_data</span> <span class="o">=</span> <span class="n">travel_surf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1"># minutes to travel 1 meter, convert to km</span>
<span class="c1"># Correct no data values</span>
<span class="n">inG_data</span><span class="p">[</span><span class="n">inG_data</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9999999999</span> <span class="c1"># untraversable</span>
<span class="c1"># inG_data[inG_data &lt; 0] = np.nan</span>
<span class="n">mcp</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">MCP_Geometric</span><span class="p">(</span><span class="n">inG_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="catchment-area">
<h2><span class="section-number">1.4. </span>Catchment Area<a class="headerlink" href="#catchment-area" title="Permalink to this headline">#</a></h2>
<p>For every health facility, calculate travel time between origin point and health facility.<br />
Then for each point, keep the id of the health facility with the minimum travel time (closest idx).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">registry</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">dest_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">([</span><span class="n">dest</span><span class="p">],</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">calculate_travel_time</span><span class="p">(</span><span class="n">travel_surf</span><span class="p">,</span> <span class="n">mcp</span><span class="p">,</span> <span class="n">dest_gdf</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># drop non-populated points</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># res_df.loc[:, registry.index] = res_df.loc[:, registry.index].apply(lambda x: x/60) # convert to hours</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>spatial_index</th>
      <th>xy</th>
      <th>pop</th>
      <th>pointid</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>...</th>
      <th>12</th>
      <th>13</th>
      <th>14</th>
      <th>15</th>
      <th>16</th>
      <th>17</th>
      <th>18</th>
      <th>19</th>
      <th>20</th>
      <th>21</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>45</th>
      <td>(1, 9)</td>
      <td>POINT (120.52083333333333 16.529166666666672)</td>
      <td>72.735962</td>
      <td>45</td>
      <td>52.235852</td>
      <td>52.650066</td>
      <td>56.892707</td>
      <td>51.003619</td>
      <td>50.650066</td>
      <td>54.064280</td>
      <td>...</td>
      <td>51.235852</td>
      <td>51.771386</td>
      <td>56.064280</td>
      <td>56.064280</td>
      <td>50.235852</td>
      <td>50.235852</td>
      <td>51.268338</td>
      <td>53.682552</td>
      <td>51.854124</td>
      <td>50.003619</td>
    </tr>
    <tr>
      <th>46</th>
      <td>(1, 10)</td>
      <td>POINT (120.52916666666665 16.529166666666672)</td>
      <td>110.319359</td>
      <td>46</td>
      <td>66.558603</td>
      <td>66.972816</td>
      <td>71.215457</td>
      <td>65.326370</td>
      <td>64.972816</td>
      <td>68.387030</td>
      <td>...</td>
      <td>65.558603</td>
      <td>66.094136</td>
      <td>70.387030</td>
      <td>70.387030</td>
      <td>64.558603</td>
      <td>64.558603</td>
      <td>65.591088</td>
      <td>68.005302</td>
      <td>66.176875</td>
      <td>64.326370</td>
    </tr>
    <tr>
      <th>47</th>
      <td>(1, 11)</td>
      <td>POINT (120.5375 16.529166666666672)</td>
      <td>28.916502</td>
      <td>47</td>
      <td>63.253009</td>
      <td>63.667223</td>
      <td>67.909863</td>
      <td>62.020776</td>
      <td>61.667223</td>
      <td>65.081436</td>
      <td>...</td>
      <td>62.253009</td>
      <td>62.788543</td>
      <td>67.081436</td>
      <td>67.081436</td>
      <td>61.253009</td>
      <td>61.253009</td>
      <td>62.285495</td>
      <td>64.699708</td>
      <td>62.871281</td>
      <td>61.020776</td>
    </tr>
    <tr>
      <th>48</th>
      <td>(1, 12)</td>
      <td>POINT (120.54583333333332 16.529166666666672)</td>
      <td>43.524239</td>
      <td>48</td>
      <td>66.272967</td>
      <td>66.687181</td>
      <td>70.929821</td>
      <td>65.040734</td>
      <td>64.687181</td>
      <td>68.101394</td>
      <td>...</td>
      <td>65.272967</td>
      <td>65.808501</td>
      <td>70.101394</td>
      <td>70.101394</td>
      <td>64.272967</td>
      <td>64.272967</td>
      <td>65.305453</td>
      <td>67.719666</td>
      <td>65.891239</td>
      <td>64.040734</td>
    </tr>
    <tr>
      <th>49</th>
      <td>(1, 13)</td>
      <td>POINT (120.55416666666666 16.529166666666672)</td>
      <td>55.734379</td>
      <td>49</td>
      <td>42.746700</td>
      <td>43.160913</td>
      <td>47.403554</td>
      <td>41.514467</td>
      <td>41.160913</td>
      <td>44.575127</td>
      <td>...</td>
      <td>41.746700</td>
      <td>42.282234</td>
      <td>46.575127</td>
      <td>46.575127</td>
      <td>40.746700</td>
      <td>40.746700</td>
      <td>42.400506</td>
      <td>44.814719</td>
      <td>42.575127</td>
      <td>40.514467</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 26 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;closest_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="n">registry</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># id of health facility that yields the minimum travel time</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;closest_idx_filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="n">registry_filter</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># same but without health stations</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Point</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">res_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#libraries for plotting maps</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">plotting_extent</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">ctx</span>
<span class="kn">import</span> <span class="nn">random</span>
</pre></div>
</div>
</div>
</div>
<section id="save-some-maps">
<h3><span class="section-number">1.4.1. </span>Save some maps<a class="headerlink" href="#save-some-maps" title="Permalink to this headline">#</a></h3>
<p>Issue here is that the colors are being repeated and grouped</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graphs_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">repo_dir</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># spec = plt.cm.get_cmap(&#39;tab20c&#39;)</span>
<span class="n">number_of_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_gdf</span><span class="o">.</span><span class="n">closest_idx</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s1">&#39;0123456789ABCDEF&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_colors</span><span class="p">)]</span>

<span class="n">custom</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Closest health facility for each grid point&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">res_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;closest_idx&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">custom</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">Terrain</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">registry</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">admin_name</span><span class="si">}</span><span class="s2">_Catchment_AllHealth.png&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/PHL_HealthFacilities_Raster_Baguio_61_0.png" src="../_images/PHL_HealthFacilities_Raster_Baguio_61_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># spec = plt.cm.get_cmap(&#39;tab20c&#39;)</span>
<span class="n">number_of_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">res_gdf</span><span class="o">.</span><span class="n">closest_idx_filter</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">color</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="s1">&#39;0123456789ABCDEF&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_colors</span><span class="p">)]</span>

<span class="n">custom</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Closest health facility for each grid point, excluding health stations&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">res_gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;closest_idx_filter&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">custom</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">Terrain</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">registry_filter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">admin_name</span><span class="si">}</span><span class="s2">_Catchment_NoStations.png&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/PHL_HealthFacilities_Raster_Baguio_63_0.png" src="../_images/PHL_HealthFacilities_Raster_Baguio_63_0.png" />
</div>
</div>
</section>
<section id="calculate-travel-time-to-nearest-health-facility-excluding-stations">
<h3><span class="section-number">1.4.2. </span>Calculate travel time to nearest health facility (excluding stations)<a class="headerlink" href="#calculate-travel-time-to-nearest-health-facility-excluding-stations" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pop_surf</span> <span class="o">=</span> <span class="n">rio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">out_pop_surface_std</span><span class="p">)</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">pop_surf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">xys</span> <span class="o">=</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">pop_surf</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;spatial_index&#39;</span><span class="p">:</span> <span class="n">indices</span><span class="p">,</span> 
    <span class="s1">&#39;xy&#39;</span><span class="p">:</span> <span class="n">xys</span><span class="p">,</span> 
    <span class="s1">&#39;pop&#39;</span><span class="p">:</span> <span class="n">pop</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="p">})</span>
<span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pointid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># same analysis but we feed all destinations at once, this returns the travel time to closest</span>
<span class="n">res_min</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">calculate_travel_time</span><span class="p">(</span><span class="n">travel_surf</span><span class="p">,</span> <span class="n">mcp</span><span class="p">,</span> <span class="n">registry_filter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="sa">f</span><span class="s2">&quot;tt_health&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_min</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">res_df</span> <span class="o">=</span> <span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">())]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>spatial_index</th>
      <th>xy</th>
      <th>pop</th>
      <th>pointid</th>
      <th>tt_health</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1583</th>
      <td>(11, 120)</td>
      <td>POINT (124.6208333333333 10.2625)</td>
      <td>233.189651</td>
      <td>1583</td>
      <td>54.864499</td>
    </tr>
    <tr>
      <th>1676</th>
      <td>(12, 80)</td>
      <td>POINT (124.2875 10.25416666666667)</td>
      <td>94.150398</td>
      <td>1676</td>
      <td>35.676160</td>
    </tr>
    <tr>
      <th>1677</th>
      <td>(12, 81)</td>
      <td>POINT (124.2958333333333 10.25416666666667)</td>
      <td>362.527374</td>
      <td>1677</td>
      <td>34.981278</td>
    </tr>
    <tr>
      <th>1682</th>
      <td>(12, 86)</td>
      <td>POINT (124.3375 10.25416666666667)</td>
      <td>24.213766</td>
      <td>1682</td>
      <td>36.106657</td>
    </tr>
    <tr>
      <th>1695</th>
      <td>(12, 99)</td>
      <td>POINT (124.4458333333333 10.25416666666667)</td>
      <td>176.003372</td>
      <td>1695</td>
      <td>39.898555</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">tt_health</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    5194.000000
mean       11.641249
std        11.376083
min         0.000000
25%         4.767767
50%         8.293451
75%        13.958109
max       120.100080
Name: tt_health, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>These values seem really low! (minutes)<br />
Maybe becuase it’s an island? We need to do some checks…</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;xy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Point</span><span class="p">)</span>
<span class="n">res_gdf_tt</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">res_df</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>  <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Travel time to nearest health facility, excluding health stations (minutes)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">res_gdf_tt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;tt_health&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">categorical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma_r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ctx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Stamen</span><span class="o">.</span><span class="n">Terrain</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>
<span class="n">registry_filter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">graphs_dir</span><span class="p">,</span> <span class="s2">&quot;Bohol_TravelTime_NoStations.png&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/PHL_HealthFacilities_Raster_Baguio_73_0.png" src="../_images/PHL_HealthFacilities_Raster_Baguio_73_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># res_min[res_min&gt;99999999] = np.nan</span>
<span class="c1"># res_min = res_min/60</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># from mpl_toolkits.axes_grid1 import make_axes_locatable</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># figsize = (12,12)</span>
<span class="c1"># fig, ax = plt.subplots(1, 1,  figsize = figsize)</span>
<span class="c1"># ax.set_title(&quot;Travel time to nearest health facility&quot;, fontsize=14)</span>

<span class="c1"># plt.axis(&#39;off&#39;)</span>
<span class="c1"># ext = plotting_extent(pop_surf)</span>

<span class="c1"># im = ax.imshow(res_min, vmin=0, vmax=1, cmap=&#39;magma_r&#39;, extent=ext)</span>
<span class="c1"># # im = ax.imshow(res_min, norm=colors.PowerNorm(gamma=0.05), cmap=&#39;YlOrRd&#39;, extent=ext)</span>
<span class="c1"># # im = ax.imshow(res_min, cmap=newcmp, extent=ext)</span>

<span class="c1"># # ctx.add_basemap(ax, source=ctx.providers.Esri.WorldShadedRelief, crs=&#39;EPSG:4326&#39;, zorder=-10)</span>
<span class="c1"># ctx.add_basemap(ax, source=ctx.providers.Stamen.Terrain, crs=&#39;EPSG:4326&#39;, zorder=-10)</span>

<span class="c1"># registry_filter.plot(ax=ax, facecolor=&#39;black&#39;, edgecolor=&#39;white&#39;, markersize=50, alpha=1)</span>
<span class="c1"># aoi.plot(ax=ax, facecolor=&#39;none&#39;, edgecolor=&#39;black&#39;)</span>

<span class="c1"># divider = make_axes_locatable(ax)</span>
<span class="c1"># cax = divider.append_axes(&#39;right&#39;, size=&quot;4%&quot;, pad=0.1)</span>
<span class="c1"># cb = fig.colorbar(im, cax=cax, orientation=&#39;vertical&#39;)</span>

<span class="c1"># plt.savefig(os.path.join(graphs_dir, &quot;Bohol_TravelTime_NoStations.png&quot;), dpi=300, bbox_inches=&#39;tight&#39;, facecolor=&#39;white&#39;)</span>
<span class="c1"># # fig = ax.get_figure()</span>
<span class="c1"># # fig.savefig(</span>
<span class="c1"># #     os.path.join(out_folder, &quot;MNG_AirportTravelTime.png&quot;),</span>
<span class="c1"># #     facecolor=&#39;white&#39;, edgecolor=&#39;none&#39;</span>
<span class="c1"># # )</span>
</pre></div>
</div>
</div>
</div>
<p>Save some output data to check values</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">registry</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;registry.shp&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/wb514197/.conda/envs/graph/lib/python3.7/site-packages/ipykernel_launcher.py:1: UserWarning: Column names longer than 10 characters will be truncated when saved to ESRI Shapefile.
  &quot;&quot;&quot;Entry point for launching an IPython kernel.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">raster_path</span> <span class="o">=</span> <span class="n">out_pop_surface_std</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;xy&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;closest_idx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_gdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s2">&quot;closest_idx&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aggregator</span><span class="o">.</span><span class="n">rasterize_gdf</span><span class="p">(</span><span class="n">res_gdf</span><span class="p">,</span> <span class="s1">&#39;closest_idx&#39;</span><span class="p">,</span> <span class="n">raster_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_folder</span><span class="p">,</span> <span class="s2">&quot;closest_idx_.tif&quot;</span><span class="p">),</span> <span class="n">nodata</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../README.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Health Planning in the Philippines</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="PHL_HealthFacilities_Raster_Maguindanao.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Catchment Areas (Maguidanao)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Development Data Partnership<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>